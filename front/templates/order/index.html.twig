{% extends 'base.html.twig' %}

{% block title %}Order{% endblock %}

{% block content %}
    {{ form_start(formOrder) }}
    <style>
        .bg-secondary {
            background-color: #f8f9fa !important;
        }
        .container {
            
        }
        .order-section {
            margin-bottom: 30px;
        }
        .order-section h3 {
            margin-top: 20px;
        }
        .order-section p {
            margin-bottom: 10px;
        }
        .btn-info {
            background-color: #17a2b8;
            border-color: #17a2b8;
            color: white;
        }
        .btn-info:hover {
            background-color: #138496;
            border-color: #117a8b;
        }
        .order-summary {
            border-top: 1px solid #ddd;
            padding-top: 15px;
            margin-top: 20px;
        }
        .order-summary img {
            max-width: 80px;
            max-height: 80px;
            object-fit: cover;
        }
        .order-summary .product-info {
            margin-left: 15px;
        }
        .order-summary .product-info h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        .order-summary .product-info p {
            margin: 5px 0;
        }
        .order-summary .product-info .price {
            font-weight: bold;
        }
        .form-control {
            margin-bottom: 10px;
        }
    </style>

    <div class="d-name d-lg-block bg-secondary position-fixed top-0 start-0 h-100" style="width: 52.5%;"></div>
    <div class="container position-relative zindex-2 pt-5 pb-lg-5 pb-md-4 pb-2">
        <div class="row">
            <div class="col-lg-6">
                <h1 class="h2 pb-2">Création de la commande</h1>
                <div class="order-section">
                    <h3 class="fs-base fw-normal text-body text-uppercase pb-1 pb-sm-1">1.
                        <span class="text-decoration-underline ms-1">Choisir votre livraison</span></h3>
                    {% if utilisateur and adresse is not null %}
                        <p><strong>Adresse de l'utilisateur :</strong> {{ adresse.intitule }} {{ adresse.codePostal }} {{ adresse.ville }} {{ adresse.pays }} {{ adresse.region }}</p>
                        <a href="{{ path('app_info_profil') }}" class="btn btn-info">Changer d'adresse</a>
                    {% else %}
                        <p>Entrez votre adresse si elle n'est pas déjà enregistrée</p>
                        <p>Adresse : {{ form_widget(formOrder.adresse.intitule, {'attr': {'class': 'form-control'}}) }}</p>
                        <p>Ville : {{ form_widget(formOrder.adresse.ville, {'attr': {'class': 'form-control'}}) }}</p>
                        <p>Région : {{ form_widget(formOrder.adresse.region, {'attr': {'class': 'form-control'}}) }}</p>
                        <p>Code postal : {{ form_widget(formOrder.adresse.code_postal, {'attr': {'class': 'form-control'}}) }}</p>
                        <p>Pays : {{ form_widget(formOrder.adresse.pays, {'attr': {'class': 'form-control'}}) }}</p>
                    {% endif %}
                </div>

                <div class="order-section">
                    <h3 class="fs-base fw-normal text-body text-uppercase mt-n4 mt-md-n3 pt-5 pb-2 pb-ms-3">2.
                        <span class="text-decoration-underline ms-1">Information personnelle</span></h3>
                    <p>Nom : {{ utilisateur.nom }}</p>
                    <p>Prénom : {{ utilisateur.prenom }}</p>
                    <p>Mail : {{ utilisateur.userIdentifier }}</p>
                </div>

                <div class="order-section">
                    <h3 class="fs-base fw-normal text-body text-uppercase mt-n4 mt-md-n3 pt-5 pb-2 pb-ms-3">3.
                        <span class="text-decoration-underline ms-1">Paiement</span></h3>
                    <p>Numéro de carte : {{ form_widget(formOrder.cb_numero, {'attr': {'class': 'form-control'}}) }}</p>
                    <p>Date d'expiration de la carte : {{ form_widget(formOrder.cb_date, {'attr': {'class': 'form-control'}}) }}</p>
                    <p>Code de la carte : {{ form_widget(formOrder.cb_code, {'attr': {'class': 'form-control'}}) }}</p>
                    {{ form_widget(formOrder.submit, {'attr': {'class': 'btn btn-primary'}}) }}
                </div>
            </div>
            <div class="col-lg-5 offset-lg-1 pt-1">
                <h2 class="pb-2 pt-md-2 my-4 mt-lg-5">Récapitulatif de votre commande<br>
                    <span class="fs-base fw-normal text-muted">({{ recapCart|length }} produits)</span></h2>
                {% set total = null %}
                {% for item in recapCart %}
                    {% set total = total + (item.product.prix * item.quantity) %}
                    <div class="order-summary d-sm-flex align-items-center border-top py-4">
                        <a class="d-inline-block flex-shrink-0 bg-secondary rounded-1 p-sm-2 p-xl-3 mb-2 mb-sm-0" href="#">
                            {% if item.product.images[0].url is defined %}
                                {% for img in item.product.images %}
                                     {% if img.principal == 1 %}
                                        <img src="{{ asset(img.url) }}" alt="{{ item.product.nom }}">
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </a>
                        <div class="w-100 pt-1 ps-sm-4 product-info">
                            <h3 class="h5 mb-2"><a href="{{ path('shop_index',{id: item.product.id}) }}">{{ item.product.nom }}</a></h3>
                            <p>{{ item.product.description }}</p>
                            <p>Quantité : x{{ item.quantity }} - Prix du produit: {{ (item.product.prix)|number_format(2, ',', '.') }} €</p>
                        </div>
                    </div>
                {% endfor %}
                <div class="order-summary">
                    <p class="price">Total : {{ (total)|number_format(2, ',', '.') }} €</p>
                </div>
            </div>
        </div>
    </div>
    {{ form_end(formOrder) }}
{% endblock %}
